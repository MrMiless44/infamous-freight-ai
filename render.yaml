# Infæmous Freight Enterprises - Production Deployment (API + Web via combined Dockerfile)

services:
- type: web
  name: infamous-freight-api
  runtime: docker
  dockerfilePath: ./Dockerfile
  envVars:
  - key: NODE_ENV
    value: production
  - key: PORT
    value: 8080
  - key: DATABASE_URL
    fromDatabase:
      name: infamous-freight-db
      property: connectionString
  - key: JWT_SECRET
    generateValue: true
  - key: AI_SYNTHETIC_ENGINE_URL
    value: http://infamous-freight-api:4000/internal/ai-sim
  - key: AI_SYNTHETIC_API_KEY
    generateValue: true
  - key: AI_SECURITY_MODE
    value: strict
  - key: STRIPE_SECRET_KEY
    sync: false
  - key: STRIPE_PUBLISHABLE_KEY
    sync: false
  - key: STRIPE_WEBHOOK_SECRET
    sync: false
  - key: SENTRY_DSN
    sync: false
  - key: REDIS_URL
    sync: false
  - key: CORS_ORIGINS
    value: https://infamous-freight-ai.onrender.com,https://infamous-freight-web.onrender.com
  - key: IP_ALLOWLIST
    value: 74.220.48.0/24,74.220.56.0/24
  - key: API_BASE_URL
    value: http://localhost:4000/api
  - key: NEXT_PUBLIC_API_BASE
    value: /api
  - key: NEXT_PUBLIC_APP_NAME
    value: Infæmous Freight
  - key: NEXT_PUBLIC_ENV
    value: production
  healthCheckPath: /api/health
  plan: starter

databases:
- name: infamous-freight-db
  databaseName: infamous_freight
  user: infamous
  plan: starter
  postgresMajorVersion: "15"
